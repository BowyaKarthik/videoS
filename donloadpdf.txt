import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.text.PDFTextStripper;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Base64;

public class DownloadAndReadPDF {
    public static void main(String[] args) {
        // Set up WebDriver (e.g., ChromeDriver)
        System.setProperty("webdriver.chrome.driver", "path/to/chromedriver");
        WebDriver driver = new ChromeDriver();

        try {
            // Step 1: Navigate to the page and trigger the blob URL generation
            driver.get("http://example.com/page-with-pdf-blob");

            // Interact with the element that triggers the blob URL generation
            WebElement downloadButton = driver.findElement(By.id("downloadButtonId")); // Replace with your element's ID
            downloadButton.click();

            // Step 2: Extract the blob URL using JavaScript
            JavascriptExecutor js = (JavascriptExecutor) driver;
            String blobUrl = (String) js.executeScript("return document.querySelector('a').href;"); // Adjust the selector if needed

            // Step 3: Download the blob content
            if (blobUrl.startsWith("blob:")) {
                // The blob URL needs to be handled differently; here's a way to process it
                String base64Content = (String) js.executeScript(
                        "return fetch(arguments[0])" +
                        ".then(response => response.blob())" +
                        ".then(blob => new Promise((resolve, reject) => {" +
                        "    let reader = new FileReader();" +
                        "    reader.onloadend = () => resolve(reader.result);" +
                        "    reader.onerror = reject;" +
                        "    reader.readAsDataURL(blob);" +
                        "}));", blobUrl);

                // Remove the prefix from the base64 string (e.g., "data:application/pdf;base64,")
                String base64Data = base64Content.split(",")[1];

                // Decode and save the PDF
                byte[] pdfData = Base64.getDecoder().decode(base64Data);
                String filePath = "downloaded.pdf";
                try (FileOutputStream fos = new FileOutputStream(filePath)) {
                    fos.write(pdfData);
                    System.out.println("PDF downloaded successfully.");
                }

                // Step 4: Read the downloaded PDF using PDFBox
                File file = new File(filePath);
                PDDocument document = PDDocument.load(file);

                // Use PDFTextStripper to extract text from the PDF
                PDFTextStripper pdfStripper = new PDFTextStripper();
                String text = pdfStripper.getText(document);

                // Output the extracted text
                System.out.println("Extracted Text:\n" + text);

                // Close the document
                document.close();
            }

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            // Close the browser
            driver.quit();
        }
    }
}
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.devtools.DevTools;
import org.openqa.selenium.devtools.v112.network.Network;

import java.util.Optional;

public class NetworkInterceptor {
    public static void main(String[] args) {
        // Set ChromeDriver path
        System.setProperty("webdriver.chrome.driver", "path_to_chromedriver");

        // Set Chrome Options
        ChromeOptions options = new ChromeOptions();
        ChromeDriver driver = new ChromeDriver(options);

        // Create DevTools session
        DevTools devTools = driver.getDevTools();
        devTools.createSession();

        // Enable Network Monitoring
        devTools.send(Network.enable(Optional.empty(), Optional.empty(), Optional.empty()));

        // Add a listener for network response
        devTools.addListener(Network.responseReceived(), response -> {
            String url = response.getResponse().getUrl();
            if (url.contains("your_api_endpoint")) { // Replace with the actual API endpoint
                System.out.println("API URL: " + url);
                System.out.println("Status: " + response.getResponse().getStatus());
                System.out.println("Response Headers: " + response.getResponse().getHeaders());

                // Extract Bearer Token from headers if available
                if (response.getResponse().getHeaders().containsKey("Authorization")) {
                    String bearerToken = response.getResponse().getHeaders().get("Authorization").toString();
                    System.out.println("Bearer Token: " + bearerToken);
                }
            }
        });

        // Navigate to the page
        driver.get("https://example.com");

        // Close the browser after work
        driver.quit();
    }
}

  String script = "let originalFetch = window.fetch;" +
                "window.fetch = function() {" +
                "    return originalFetch.apply(this, arguments).then(response => {" +
                "        response.clone().json().then(data => {" +
                "            console.log('Response Data:', data);" +
                "        });" +
                "        return response;" +
                "    });" +
                "};";

        ((JavascriptExecutor) driver).executeScript(script);
String tokenScript = "return localStorage.getItem('authToken');";

// Retrieve all keys stored in localStorage
List<String> keys = (List<String>) ((JavascriptExecutor) driver).executeScript(
    "return Object.keys(localStorage);"
);

for (String key : keys) {
    System.out.println("localStorage Key: " + key);
}
  public String getItemFromLocalStorage(String key) {
    return (String) js.executeScript(String.format(
        "return window.localStorage.getItem('%s');", key));
  }
import net.lightbody.bmp.BrowserMobProxy;
import net.lightbody.bmp.BrowserMobProxyServer;
import net.lightbody.bmp.client.ClientUtil;
import net.lightbody.bmp.core.har.Har;
import net.lightbody.bmp.core.har.HarEntry;
import org.openqa.selenium.Proxy;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.edge.EdgeOptions;
import io.github.bonigarcia.wdm.WebDriverManager;

public class CaptureTokenMidScript {

    public static void main(String[] args) {
        // Start BrowserMob Proxy
        BrowserMobProxy proxy = new BrowserMobProxyServer();
        proxy.start(0);  // Starts on any available port

        // Configure Selenium to use BrowserMob Proxy
        Proxy seleniumProxy = ClientUtil.createSeleniumProxy(proxy);
        WebDriverManager.edgedriver().setup();
        EdgeOptions options = new EdgeOptions();
        options.setProxy(seleniumProxy);

        WebDriver driver = new EdgeDriver(options);

        // Enable HAR (HTTP Archive) to capture network traffic
        proxy.newHar("token_capture");

        // Navigate to your application (where the token is expected to be retrieved in between)
        driver.get("https://example.com");  // Replace with your app's URL

        // Perform actions leading to the API call (such as login or interaction that triggers the token retrieval)
        // E.g., driver.findElement(By.id("login")).click();

        // After triggering the token-generating API call, retrieve the HAR
        Har har = proxy.getHar();

        // Iterate over the HAR entries to find the API call that contains the token
        for (HarEntry entry : har.getLog().getEntries()) {
            String requestUrl = entry.getRequest().getUrl();
            if (requestUrl.contains("your_api_endpoint")) {  // Replace with the actual API endpoint URL
                System.out.println("API URL: " + requestUrl);

                // Check for Authorization header in the response or request
                entry.getResponse().getHeaders().forEach(header -> {
                    if (header.getName().equalsIgnoreCase("Authorization")) {
                        String authorizationHeader = header.getValue();
                        if (authorizationHeader.startsWith("Bearer")) {
                            String bearerToken = authorizationHeader.substring("Bearer ".length());
                            System.out.println("Bearer Token: " + bearerToken);
                        }
                    }
                });

                // Alternatively, if the token is in the response body (e.g., JSON)
                String responseBody = entry.getResponse().getContent().getText();
                if (responseBody.contains("access_token")) {
                    // Extract token from JSON response (you can use a JSON parser like Jackson or Gson here)
                    String bearerToken = responseBody.split("\"access_token\":\"")[1].split("\"")[0];
                    System.out.println("Bearer Token from body: " + bearerToken);
                }
            }
        }

        // Continue with your test script, now having access to the token if needed

        // Stop the proxy and close the browser
        proxy.stop();
        driver.quit();
    }
}
